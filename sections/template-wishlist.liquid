





<section class="min-h-screen px-4 py-10">
  <div class="max-w-6xl mx-auto">

    <!-- Dynamic Heading -->
    <h1 class="text-3xl md:text-4xl font-extrabold text-center mb-6 bg-gradient-to-r from-yellow-600 to-black bg-clip-text text-transparent">
      {{ section.settings.heading }}
    </h1>

    <!-- Dynamic Subheading -->
    <p class="text-center text-gray-600 mb-8 text-sm">
      {{ section.settings.subheading }}
    </p>

    <!-- Empty state -->
    <p id="wishlist-empty" class="text-center text-gray-500 text-lg hidden">
      Your wishlist is empty. Start adding products â™¥
    </p>

    <!-- Product Grid -->
    <div id="wishlist-grid"
      class="grid grid-cols-2 md:grid-cols-{{ section.settings.products_per_row }} gap-6 mt-6">
    </div>
  </div>
</section>

<script>


document.addEventListener("DOMContentLoaded", function () {
  let wishlist = JSON.parse(localStorage.getItem("wishlist") || "[]");

  //  REMOVE DUPLICATES AUTOMATICALLY
  wishlist = [...new Set(wishlist)];
  localStorage.setItem("wishlist", JSON.stringify(wishlist));

  let grid = document.getElementById("wishlist-grid");
  let empty = document.getElementById("wishlist-empty");

  if (wishlist.length === 0) {
    empty.classList.remove("hidden");
    return;
  } else {
    empty.classList.add("hidden");
  }

  // Load wishlist products
  grid.innerHTML = "";  // ðŸš¨ clears previous DOM cards
let alreadyRendered = new Set();
wishlist.forEach(handle => {
    if (alreadyRendered.has(handle)) return;
    alreadyRendered.add(handle);

    fetch(`/products/${handle}.js`)
      .then(res => res.json())
      .then(product => {
        let item = document.createElement("div");
        item.className = "border bg-white rounded-lg shadow overflow-hidden p-2 flex flex-col";

        item.innerHTML = `
          <a href="/products/${product.handle}" class="block mb-2">
            <img src="${product.images[0]}" alt="${product.title}" class="w-full h-48 object-cover rounded-md">
          </a>

          <h3 class="text-sm font-semibold text-gray-800 line-clamp-2">${product.title}</h3>
          <p class="text-sm text-gray-600 my-1">
            ${(product.price / 100).toLocaleString("en-IN", { style: "currency", currency: "INR" })}
          </p>

          <button class="remove-wishlist-btn mt-auto bg-gray-800 text-white text-sm py-2 rounded-md"
            data-handle="${product.handle}">
            Remove
          </button>
        `;

        grid.appendChild(item);
      });
  });


  // Remove from wishlist
  // Remove from wishlist
document.addEventListener("click", e => {
  let btn = e.target.closest(".remove-wishlist-btn");
  if (!btn) return;

  let handle = btn.dataset.handle;
  let wishlist = JSON.parse(localStorage.getItem("wishlist") || "[]");

  wishlist = wishlist.filter(h => h !== handle);
  localStorage.setItem("wishlist", JSON.stringify(wishlist));

  grid.innerHTML = "";      // clear DOM (fix duplicate)
  renderWishlistPage();     // rerender clean
});

</script>

{% schema %}
{
  "name": "Wishlist products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "My Wishlist"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Products you have saved."
    },
    {
      "type": "range",
      "id": "products_per_row",
      "label": "Products per row",
      "min": 2,
      "max": 5,
      "default": 4
    }
  ],
  "presets": [
    { "name": "Wishlist products" }
  ]
}
{% endschema %}
